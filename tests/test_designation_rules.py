import pytest

from app.designations.rules import RULES

RULE_CASES: list[tuple[str, str, str | None]] = [
    ("NGC", "NGC 905", "NGC 905"),
    ("NGC", "NGC905", "NGC 905"),
    ("NGC", "NGC00905", "NGC 905"),
    ("NGC", "NGC  905", "NGC 905"),
    ("NGC", "ngc 905", "NGC 905"),
    ("NGC", "NGC1487a", "NGC 1487a"),
    ("NGC", "NGC1487b", "NGC 1487b"),
    ("NGC", "NGC3521sat", "NGC 3521sat"),
    ("NGC", "NGC", None),
    ("NGC", "NGC ", None),
    ("NGC", "M 31", None),
    ("NGC", "UGC 123", None),
    ("NGC", "", None),
    ("SDSS", "SDSSJ121551.62+573421.6", "SDSS J121551.62+573421.6"),
    ("SDSS", "SDSSJ121552.44+294932.9", "SDSS J121552.44+294932.9"),
    ("SDSS", "SDSSJ121553.17+202452.4", "SDSS J121553.17+202452.4"),
    ("SDSS", "sdssj121551.62+573421.6", "SDSS J121551.62+573421.6"),
    ("SDSS", "SDSSJ121551.62-573421.6", "SDSS J121551.62-573421.6"),
    ("SDSS", "SDSSJ121551.62+57342.6", None),
    ("SDSS", "SDSS J121551.62+573421.6", None),
    ("SDSS", "", None),
    ("PGC", "PGC1191069", "PGC 1191069"),
    ("PGC", "PGC1119121", "PGC 1119121"),
    ("PGC", "PGC1425552", "PGC 1425552"),
    ("PGC", "PGC 1191069", "PGC 1191069"),
    ("PGC", "PGC001191069", "PGC 1191069"),
    ("PGC", "pgc1191069", "PGC 1191069"),
    ("PGC", "PGC", None),
    ("PGC", "PGC ", None),
    ("PGC", "UGC 123", None),
    ("PGC", "", None),
    ("3C", "3C223.1", "3C 223.1"),
    ("3C", "3C192", "3C 192"),
    ("3C", "3C 236", "3C 236"),
    ("3C", "3c310", "3C 310"),
    ("3C", "3C218A", "3C 218A"),
    ("3C", "3C 218A", "3C 218A"),
    ("3C", "3c218a", "3C 218a"),
    ("3C", "3C", None),
    ("3C", "", None),
    ("2MASS", "2MASSJ16295276+3911433", "2MASS J16295276+3911433"),
    ("2MASS", "2massj16295276+3911433", "2MASS J16295276+3911433"),
    ("2MASS", "2MASSJ16295276+391143", None),
    ("2MASS", "2MASS J16295276+3911433", None),
    ("2MASS", "", None),
    ("2MASX", "2MASXJ21024892-2410520", "2MASX J21024892-2410520"),
    ("2MASX", "2MASXJ09592150-2733330", "2MASX J09592150-2733330"),
    ("2MASX", "2MASXJ10274703+2725368", "2MASX J10274703+2725368"),
    ("2MASX", "2masxj09592150-2733330", "2MASX J09592150-2733330"),
    ("2MASX", "2MASSJ16295276+3911433", None),
    ("2MASX", "", None),
    ("WINGS", "WINGSJ125634.96-173656.6", "WINGS J125634.96-173656.6"),
    ("WINGS", "WINGSJ232248.36+143927.6", "WINGS J232248.36+143927.6"),
    ("WINGS", "WINGSJ234427.24+091831.8", "WINGS J234427.24+091831.8"),
    ("WINGS", "WINGSJ005617.13-012206.3", "WINGS J005617.13-012206.3"),
    ("WINGS", "WINGSJ132627.17-271414.2", "WINGS J132627.17-271414.2"),
    ("WINGS", "wingsj125634.96-173656.6", "WINGS J125634.96-173656.6"),
    ("WINGS", "WINGS J125634.96-173656.6", None),
    ("WINGS", "", None),
    ("GAMA", "GAMA077963", "GAMA 77963"),
    ("GAMA", "GAMA028694", "GAMA 28694"),
    ("GAMA", "GAMA297074", "GAMA 297074"),
    ("GAMA", "GAMA345748", "GAMA 345748"),
    ("GAMA", "GAMA 77963", "GAMA 77963"),
    ("GAMA", "gama077963", "GAMA 77963"),
    ("GAMA", "GAMA", None),
    ("GAMA", "", None),
    ("MGC", "MGC56790", "MGC 56790"),
    ("MGC", "MGC47128", "MGC 47128"),
    ("MGC", "MGC 56790", "MGC 56790"),
    ("MGC", "mgc56790", "MGC 56790"),
    ("MGC", "MGC", None),
    ("MGC", "", None),
    ("M", "MESSIER082", "M 82"),
    ("M", "M82", "M 82"),
    ("M", "M 82", "M 82"),
    ("M", "m31", "M 31"),
    ("M", "MCG 123", None),
    ("M", "", None),
    ("HIP", "HIP113070", "HIP 113070"),
    ("HIP", "HIP 113070", "HIP 113070"),
    ("HIP", "hip113070", "HIP 113070"),
    ("HIP", "HIP", None),
    ("HIP", "", None),
    ("HD", "HD097243", "HD 97243"),
    ("HD", "HD044063", "HD 44063"),
    ("HD", "HD073216", "HD 73216"),
    ("HD", "HD158365", "HD 158365"),
    ("HD", "HD114550", "HD 114550"),
    ("HD", "HD267907", "HD 267907"),
    ("HD", "HD073612", "HD 73612"),
    ("HD", "HD 97243", "HD 97243"),
    ("HD", "hd097243", "HD 97243"),
    ("HD", "HD", None),
    ("HD", "", None),
    ("BD", "BD+062136", "BD +062136"),
    ("BD", "BD+391991", "BD +391991"),
    ("BD", "BD-123456", "BD -123456"),
    ("BD", "BD +062136", "BD +062136"),
    ("BD", "bd+062136", "BD +062136"),
    ("BD", "BD062136", None),
    ("BD", "", None),
    ("Andromeda", "And XXVIII", "Andromeda 28"),
    ("Andromeda", "Andromeda XXVIII", "Andromeda 28"),
    ("Andromeda", "And28", "Andromeda 28"),
    ("Andromeda", "ANDXXVIII", "Andromeda 28"),
    ("Andromeda", "andxxviii", "Andromeda 28"),
    ("Andromeda", "andromeda28", "Andromeda 28"),
    ("Andromeda", "And 28", "Andromeda 28"),
    ("Andromeda", "Andromeda I", "Andromeda 1"),
    ("Andromeda", "Andromeda IV", "Andromeda 4"),
    ("Andromeda", "And X", "Andromeda 10"),
    ("Andromeda", "Andromeda", None),
    ("Andromeda", "And", None),
    ("Andromeda", "", None),
    ("ESO", "ESO104-044", "ESO 104-44"),
    ("ESO", "ESO381-020", "ESO 381-20"),
    ("ESO", "ESO 104-044", "ESO 104-44"),
    ("ESO", "eso104-044", "ESO 104-44"),
    ("ESO", "ESO188-012A", "ESO 188-12A"),
    ("ESO", "ESO410-G005", "ESO 410-G5"),
    ("ESO", "ESO112-008A", "ESO 112-8A"),
    ("ESO", "eso146-006a", "ESO 146-6a"),
    ("ESO", "ESO104", None),
    ("ESO", "ESO", None),
    ("ESO", "", None),
    ("CGCG", "CGCG 066-109", "CGCG 066-109"),
    ("CGCG", "CGCG217-018", "CGCG 217-18"),
    ("CGCG", "cgcg066-109", "CGCG 066-109"),
    ("CGCG", "CGCG 066-09", "CGCG 066-09"),
    ("CGCG", "CGCG66-109", None),
    ("CGCG", "", None),
    ("DR8", "DR8-1996p672-237", "DR8-1996p672-237"),
    ("DR8", "DR8-3423p297-8", "DR8-3423p297-8"),
    ("DR8", "DR8-2056p285-12718", "DR8-2056p285-12718"),
    ("DR8", "DR8-0819m622-13740", "DR8-0819m622-13740"),
    ("DR8", "DR8-0850m475-585", "DR8-0850m475-585"),
    ("DR8", "dr8-1236p155-1835", "DR8-1236p155-1835"),
    ("DR8", "DR8-1996p67-237", None),
    ("DR8", "", None),
    ("KUG", "KUG 0937+480", "KUG 0937+480"),
    ("KUG", "KUG0937+48", "KUG 0937+48"),
    ("KUG", "kug0937+480", "KUG 0937+480"),
    ("KUG", "KUG0937+4", None),
    ("KUG", "", None),
    ("SBS", "SBS 1224+533", "SBS 1224+533"),
    ("SBS", "SBS1224+53", "SBS 1224+53"),
    ("SBS", "sbs1224+533", "SBS 1224+533"),
    ("SBS", "SBS1224+5", None),
    ("SBS", "", None),
    ("HIPASS", "HIPASSJ1558-10", "HIPASS J1558-10"),
    ("HIPASS", "HIPASS J1348-37", "HIPASS J1348-37"),
    ("HIPASS", "HIPASS J0916-23b", "HIPASS J0916-23b"),
    ("HIPASS", "hipassj1558-10", "HIPASS J1558-10"),
    ("HIPASS", "HIPASSJ1558-1", None),
    ("HIPASS", "HIPASS 1348-37", None),
    ("HIPASS", "", None),
    ("SMDG", "SMDG1256-00", "SMDG 1256-00"),
    ("SMDG", "SMDG0740+40", "SMDG 0740+40"),
    ("SMDG", "SMDG1103517+284120", "SMDG 1103517+284120"),
    ("SMDG", "smdg1349+04", "SMDG 1349+04"),
    ("SMDG", "SMDG 1256-00", "SMDG 1256-00"),
    ("SMDG", "SMDG1256-0", None),
    ("SMDG", "", None),
    ("FASHI", "FASHI1334+62", "FASHI 1334+62"),
    ("FASHI", "FASHI0252+40", "FASHI 0252+40"),
    ("FASHI", "FASHI 1251+57", "FASHI 1251+57"),
    ("FASHI", "fashi0237+38", "FASHI 0237+38"),
    ("FASHI", "FASHI1334+6", None),
    ("FASHI", "", None),
    ("ISI96", "ISI96_1450+0230", "ISI96_1450+0230"),
    ("ISI96", "ISI96_2339-0122", "ISI96_2339-0122"),
    ("ISI96", "ISI96_1042+0231", "ISI96_1042+0231"),
    ("ISI96", "isi96_0922+0233", "ISI96_0922+0233"),
    ("ISI96", "ISI96_1450+023", None),
    ("ISI96", "", None),
    ("MAGE", "MAGE1423+5613", "MAGE 1423+5613"),
    ("MAGE", "MAGE0740+1651", "MAGE 0740+1651"),
    ("MAGE", "mage1132+5311", "MAGE 1132+5311"),
    ("MAGE", "MAGE 1423+5613", "MAGE 1423+5613"),
    ("MAGE", "MAGE1423+561", None),
    ("MAGE", "", None),
    ("VCC", "VCC0114", "VCC 114"),
    ("VCC", "VCC 114", "VCC 114"),
    ("VCC", "vcc0114", "VCC 114"),
    ("VCC", "VCC", None),
    ("VCC", "", None),
    ("EVCC", "EVCC2232", "EVCC 2232"),
    ("EVCC", "EVCC 2232", "EVCC 2232"),
    ("EVCC", "evcc2232", "EVCC 2232"),
    ("EVCC", "EVCC", None),
    ("EVCC", "", None),
    ("UCD", "UCD330", "UCD 330"),
    ("UCD", "UCD 330", "UCD 330"),
    ("UCD", "ucd330", "UCD 330"),
    ("UCD", "UCD", None),
    ("UCD", "", None),
    ("UGCA", "UGCA442", "UGCA 442"),
    ("UGCA", "UGCA 442", "UGCA 442"),
    ("UGCA", "ugca442", "UGCA 442"),
    ("UGCA", "UGC 442", None),
    ("UGCA", "", None),
    ("AM", "AM 0316-484", "AM 0316-484"),
    ("AM", "AM2220-460", "AM 2220-460"),
    ("AM", "am0316-484", "AM 0316-484"),
    ("AM", "AM 2220-460", "AM 2220-460"),
    ("AM", "AM0316-4", None),
    ("AM", "", None),
    ("KKS", "KKS74", "KKS 74"),
    ("KKS", "KKS 74", "KKS 74"),
    ("KKS", "kks74", "KKS 74"),
    ("KKS", "KKSG37", None),
    ("KKS", "", None),
    ("UGC", "UGC05983", "UGC 5983"),
    ("UGC", "UGC07085W", "UGC 7085W"),
    ("UGC", "UGC02140A", "UGC 2140A"),
    ("UGC", "UGC 5983", "UGC 5983"),
    ("UGC", "ugc07020a", "UGC 7020a"),
    ("UGC", "UGC", None),
    ("UGC", "", None),
    ("IC", "IC1613", "IC 1613"),
    ("IC", "IC 1613", "IC 1613"),
    ("IC", "IC1670A", "IC 1670A"),
    ("IC", "ic1670a", "IC 1670a"),
    ("IC", "ic1613", "IC 1613"),
    ("IC", "IC", None),
    ("IC", "", None),
    ("DDO", "DDO217", "DDO 217"),
    ("DDO", "DDO226", "DDO 226"),
    ("DDO", "DDO 217", "DDO 217"),
    ("DDO", "ddo217", "DDO 217"),
    ("DDO", "DDO", None),
    ("DDO", "", None),
    ("AGC", "AGC724906", "AGC 724906"),
    ("AGC", "AGC731457", "AGC 731457"),
    ("AGC", "AGC 724906", "AGC 724906"),
    ("AGC", "agc724906", "AGC 724906"),
    ("AGC", "AGC", None),
    ("AGC", "", None),
    ("Dw", "Dw1311+4051", "Dw 1311+4051"),
    ("Dw", "Dw1106-0052", "Dw 1106-0052"),
    ("Dw", "dw1048+1259", "Dw 1048+1259"),
    ("Dw", "dw1323-40", "Dw 1323-40"),
    ("Dw", "dw1051+11", "Dw 1051+11"),
    ("Dw", "dw1045+14b", "Dw 1045+14b"),
    ("Dw", "Dw1045+14B", "Dw 1045+14b"),
    ("Dw", "Dw1252-0506", "Dw 1252-0506"),
    ("Dw", "Dw 1311+4051", "Dw 1311+4051"),
    ("Dw", "Dw1311+405", None),
    ("Dw", "Dw1311+40511", None),
    ("Dw", "Dw", None),
    ("Dw", "", None),
    ("KSP-DW", "KSP-DW28", "KSP-DW 28"),
    ("KSP-DW", "KSP-DW1", "KSP-DW 1"),
    ("KSP-DW", "KSP-DW 12", "KSP-DW 12"),
    ("KSP-DW", "ksp-dw30", "KSP-DW 30"),
    ("KSP-DW", "KSP-DW", None),
    ("KSP-DW", "", None),
    ("LSBC", "LSBC D640-12", "LSBC D640-12"),
    ("LSBC", "LSBC D565-06", "LSBC D565-6"),
    ("LSBC", "lsbc d640-12", "LSBC D640-12"),
    ("LSBC", "LSBC D640", None),
    ("LSBC", "", None),
    ("LV", "LV J1235-1104", "LV J1235-1104"),
    ("LV", "LV J1052+3628", "LV J1052+3628"),
    ("LV", "lv j1235-1104", "LV J1235-1104"),
    ("LV", "LV 1235-1104", None),
    ("LV", "", None),
    ("MCG", "MCG -04-31-038", "MCG -04-31-38"),
    ("MCG", "MCG -04-31-38", "MCG -04-31-38"),
    ("MCG", "mcg -04-31-038", "MCG -04-31-38"),
    ("MCG", "MCG 04-31-038", "MCG 04-31-38"),
    ("MCG", "MCG", None),
    ("MCG", "", None),
    ("KDG", "KDG056", "KDG 56"),
    ("KDG", "KDG162", "KDG 162"),
    ("KDG", "KDG 216", "KDG 216"),
    ("KDG", "kdg056", "KDG 56"),
    ("KDG", "KDG", None),
    ("KDG", "", None),
    ("KKSG", "KKSG37", "KKSG 37"),
    ("KKSG", "KKSG34", "KKSG 34"),
    ("KKSG", "kksg37", "KKSG 37"),
    ("KKSG", "KKSG", None),
    ("KKSG", "", None),
    ("KKH", "KKH69", "KKH 69"),
    ("KKH", "KKH 69", "KKH 69"),
    ("KKH", "kkh69", "KKH 69"),
    ("KKH", "KK69", None),
    ("KKH", "KKH", None),
    ("KKH", "", None),
    ("KKR", "KKR18", "KKR 18"),
    ("KKR", "KKR 18", "KKR 18"),
    ("KKR", "kkr18", "KKR 18"),
    ("KKR", "KKR", None),
    ("KKR", "", None),
    ("KK", "KK203", "KK 203"),
    ("KK", "KK242", "KK 242"),
    ("KK", "KK 203", "KK 203"),
    ("KK", "kk242", "KK 242"),
    ("KK", "KKH69", None),
    ("KK", "KKR18", None),
    ("KK", "KK", None),
    ("KK", "", None),
    ("BTS", "BTS132", "BTS 132"),
    ("BTS", "BTS157", "BTS 157"),
    ("BTS", "BTS 132", "BTS 132"),
    ("BTS", "bts132", "BTS 132"),
    ("BTS", "BTS", None),
    ("BTS", "", None),
    ("JKB", "JKB129", "JKB 129"),
    ("JKB", "JKB 129", "JKB 129"),
    ("JKB", "jkb129", "JKB 129"),
    ("JKB", "JKB", None),
    ("JKB", "", None),
    ("2QZ", "2QZJ233027.0-280856", "2QZ J233027.0-280856"),
    ("2QZ", "2QZJ121201.1+012648", "2QZ J121201.1+012648"),
    ("2QZ", "2QZJ103110.2+001703", "2QZ J103110.2+001703"),
    ("2QZ", "2qzj233027.0-280856", "2QZ J233027.0-280856"),
    ("2QZ", "2QZJ233027-280856", "2QZ J233027-280856"),
    ("2QZ", "", None),
    ("6dF", "6dFJ2032543-251656", "6dF J2032543-251656"),
    ("6dF", "6dFJ1605369-301035", "6dF J1605369-301035"),
    ("6dF", "6dFJ1253111-272754:", "6dF J1253111-272754"),
    ("6dF", "6dfj2016142-085824", "6dF J2016142-085824"),
    ("6dF", "6dFJ203254-251656", None),
    ("6dF", "", None),
    ("ABELL", "ABELL0076", "ABELL 76"),
    ("ABELL", "ABELL0496:[DAL2002]11866", "ABELL 496 [DAL2002] 11866"),
    ("ABELL", "ABELL2204_14:[PSE2006]2096", "ABELL 2204_14 [PSE2006] 2096"),
    ("ABELL", "ABELL2744:[BGS2006]011", "ABELL 2744 [BGS2006] 011"),
    ("ABELL", "abell0496:[DAL2002]11866", "ABELL 496 [DAL2002] 11866"),
    ("ABELL", "ABELL0496", "ABELL 496"),
    ("ABELL", "ABELL 496", "ABELL 496"),
    ("ABELL", "", None),
    ("CNOC2", "CNOC2_0223.051394", "CNOC2_0223.051394"),
    ("CNOC2", "CNOC2_0223.100322", "CNOC2_0223.100322"),
    ("CNOC2", "cnoc2_0223.140942", "CNOC2_0223.140942"),
    ("CNOC2", "CNOC2_0223.090502", "CNOC2_0223.090502"),
    ("CNOC2", "CNOC20223.051394", None),
    ("CNOC2", "", None),
    ("LAMOST", "LAMOSTJ003619.93+320329.5", "LAMOST J003619.93+320329.5"),
    ("LAMOST", "LAMOSTJ022723.16+013324.5", "LAMOST J022723.16+013324.5"),
    ("LAMOST", "lamostj085334.71+262244.1", "LAMOST J085334.71+262244.1"),
    ("LAMOST", "LAMOSTJ003619+320329", "LAMOST J003619+320329"),
    ("LAMOST", "", None),
    ("2MFGC", "2MFGC15266", "2MFGC 15266"),
    ("2MFGC", "2MFGC 15266", "2MFGC 15266"),
    ("2MFGC", "2mfgc15266", "2MFGC 15266"),
    ("2MFGC", "2MFGC", None),
    ("2MFGC", "", None),
    ("VVDS", "VVDS220456214", "VVDS 220456214"),
    ("VVDS", "VVDS 220456214", "VVDS 220456214"),
    ("VVDS", "vvds220456214", "VVDS 220456214"),
    ("VVDS", "VVDS", None),
    ("VVDS", "", None),
    ("GALFA", "GALFAJ180.8+24.1+032", "GALFA J180.8+24.1+032"),
    ("GALFA", "galfaj180.8+24.1+032", "GALFA J180.8+24.1+032"),
    ("GALFA", "GALFAJ180.8+24.1", None),
    ("GALFA", "", None),
    ("USGC", "USGCU169", "USGC U169"),
    ("USGC", "usgcu169", "USGC U169"),
    ("USGC", "USGC U169", None),
    ("USGC", "", None),
    ("RXJ", "RXJ0152.7-1357", "RX J0152.7-1357"),
    ("RXJ", "RXJ0152.7-1357:[DRL2005]0396", "RX J0152.7-1357 [DRL2005] 0396"),
    ("RXJ", "rxj0152.7-1357", "RX J0152.7-1357"),
    ("RXJ", "RXJ0152-1357", "RX J0152-1357"),
    ("RXJ", "", None),
    ("CLJ", "CLJ1604+4304", "CL J1604+4304"),
    ("CLJ", "CLJ1604+4304:[PLO98]3268", "CL J1604+4304 [PLO98] 3268"),
    ("CLJ", "clj1604+4304", "CL J1604+4304"),
    ("CLJ", "CLJ160+4304", None),
    ("CLJ", "", None),
    ("SMMJ", "SMMJ221733.02+000906.0", "SMM J221733.02+000906.0"),
    ("SMMJ", "smmj221733.02+000906.0", "SMM J221733.02+000906.0"),
    ("SMMJ", "SMMJ221733+000906", "SMM J221733+000906"),
    ("SMMJ", "", None),
    ("PANDAS", "PANDAS57", "PANDAS 57"),
    ("PANDAS", "PANDAS 57", "PANDAS 57"),
    ("PANDAS", "pandas57", "PANDAS 57"),
    ("PANDAS", "PANDAS", None),
    ("PANDAS", "", None),
    ("LAEVENS", "LAEVENS2", "LAEVENS 2"),
    ("LAEVENS", "LAEVENS 2", "LAEVENS 2"),
    ("LAEVENS", "laevens2", "LAEVENS 2"),
    ("LAEVENS", "LAEVENS", None),
    ("LAEVENS", "", None),
    ("BSDL", "BSDL2844", "BSDL 2844"),
    ("BSDL", "BSDL 2844", "BSDL 2844"),
    ("BSDL", "bsdl2844", "BSDL 2844"),
    ("BSDL", "BSDL", None),
    ("BSDL", "", None),
    ("NGC", "NGC1672:[EKS96]207", "NGC 1672 [EKS96] 207"),
    ("NGC", "NGC 1672:[EKS96]207", "NGC 1672 [EKS96] 207"),
    ("NGC", "ngc1672:[EKS96]207", "NGC 1672 [EKS96] 207"),
]


@pytest.mark.parametrize("rule_name,input_name,expected", RULE_CASES)
def test_rule_match(rule_name: str, input_name: str, expected: str | None) -> None:
    rules_with_name = [r for r in RULES if r.name == rule_name]
    result = None
    for rule in rules_with_name:
        result = rule.match(input_name)
        if result is not None:
            break
    if expected is None:
        assert result is None
    else:
        assert result == expected


def test_unmatched_name_returns_none_from_all_rules() -> None:
    for rule in RULES:
        assert rule.match("unknown catalog XYZ 123") is None
